# RVCompiler
## Runtime Verification - Test Assignment

This project contains a simple compiler that reads a program written in the language described by the grammar below, parses it creating an AST, and then generates the LLVM bytecodes of the program. The compiler outputs this LLVM bytecodes as `filename.ll`, but can also execute it using a simple JIT implementation that prints the program's output on the standard output.

## Grammar
```
syntax Pgm ::= "print" "(" Exp ")" ";"
syntax Exp ::= Int
             | "(" Exp ")"
             | "-" Exp
             | Exp "*" Exp
             | Exp "/" Exp
             | Exp "+" Exp
             | Exp "-" Exp
syntax Int ::= r"[0-9]+"

```
## Disclaimer:

This compiler is written mainly in C++, built with the softwares listed below, and was tested on a MacOS 13.0.1.
Two major decisions made on the design of this project were whether to use the C or C++ API of Bison and Flex. Unfortunately, the C++ interfaces of these softwares are really poor, and most people still use the C API of them until those days.
However, the Flex C++ API has a great advantage: it can read the input from a file as istream, and since this compiler is written in C++, passing the input file directly to the scanner pays for other downsides. The Bison C++ API doesn't have significant benefits, so I chose not to use it in this project.


# Requirements
```
cmake version 3.22.3
ninja version 1.10.2
bison (GNU Bison) 3.8.2
flex 2.6.4
LLVM 14.0.0
```

# Building
This compiler can be built using CMake and Ninja as shown below:
```
mkdir build
cd build

cmake .. -G Ninja
ninja
```

# Executing llvm-lit Tests
This project contains a test-suit with 24 tests divided between:
- CodeGen Tests: Check if the LLVM bytecodes were correctly generated by the compiler
- JIT Output: Check if the execution of the tests outputs the expected results.

To execute the test-suit with the command below just type it **inside the build** directory.
```
ninja check
```

# Generating LLVM Bytecode
To use the compiler binary to directly generate the LLVM bytecode simply type this command:
```
./bin/RVCompiler ../tests/inputs/complex.rv
```
The output file is created inside the current directory with the ".ll" extension.



# Executing program with RV-JIT
To use the JIT compiler to execute a program just type this command:
```
./bin/RVCompiler ../tests/inputs/complex.rv --jit
```

# Executing LLVM Bytecode with lli
It's also possible to use the [lli](https://llvm.org/docs/CommandGuide/lli.html) binary to execute the LLVM bytecodes produced by this compiler.
```
./bin/RVCompiler ../tests/inputs/complex.rv
lli complexTest.ll
```

# Extra: Mamba Package Mananger
If you use the Mamba Package Manager, it's possible to install all the requirements of this project in an environment with a single command.
```
 mamba env create --file=environment.yml -n RVCompiler
```